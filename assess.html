<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ØªØ´Ø®ÙŠØµ Ø²Ø±Ø§Ø¹ÙŠ Ø°ÙƒÙŠ</title>
<style>
  :root{
    --bg: url("https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?q=80&w=2560&auto=format&fit=crop");
    --green:#2e7d32; --green-dark:#1b5e20;
    --text:#f2f7f1; --muted:#cfe3cf; --card:#1b241b;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:"Segoe UI", Tahoma, Arial, sans-serif; color:var(--text);
    background:
      radial-gradient(1100px 600px at 80% 20%, rgba(46,125,50,.18), transparent 60%),
      radial-gradient(900px 500px at 15% 85%, rgba(141,110,99,.10), transparent 60%),
      var(--bg) center/cover fixed no-repeat;
    display:flex; flex-direction:column; min-height:100dvh; overflow-x:hidden;
  }
  header{position:sticky; top:0; z-index:10; background:rgba(18,24,18,.92); border-bottom:1px solid rgba(255,255,255,.12)}
  .nav{max-width:1200px; margin:auto; padding:10px 16px; display:flex; align-items:center; gap:8px; flex-wrap:wrap}
  .brand{font-weight:800; margin-inline-end:8px}
  .nav a{color:#e9f7e9; text-decoration:none; padding:8px 10px; border-radius:10px; opacity:.9}
  .nav a:hover{background:rgba(255,255,255,.06); opacity:1}
  .nav .spacer{flex:1}
  .current{background:rgba(46,125,50,.25); border:1px solid rgba(46,125,50,.5)}
  main{flex:1; padding:24px}
  .grid{max-width:1200px; margin:auto; display:grid; gap:18px; grid-template-columns:1fr}
  @media(min-width:980px){ .grid{grid-template-columns:520px 1fr} }
  .card{
    background:linear-gradient(180deg, rgba(27,36,27,.92), rgba(27,36,27,.82)), var(--card);
    border:1px solid rgba(255,255,255,.16); border-radius:20px; padding:18px;
    box-shadow:0 20px 40px rgba(0,0,0,.45), 0 0 0 1px rgba(255,255,255,.06) inset;
  }
  h1{margin:6px 0 12px; font-size:28px}
  h2{margin:0 0 12px; font-size:20px; color:var(--muted)}
  .hint{color:var(--muted); font-size:13px}

  .section{margin-top:10px}
  .section-title{font-weight:800; margin:10px 0 8px}
  .chips{display:flex; flex-wrap:wrap; gap:8px}
  .chip{
    display:inline-flex; align-items:center; gap:6px;
    border:1px solid rgba(255,255,255,.18); border-radius:999px;
    padding:8px 12px; cursor:pointer; user-select:none;
    background:#243024; transition:.15s;
  }
  .chip input{display:none}
  .chip.active{outline:3px solid rgba(46,125,50,.25); background:#2a372a}

  .row{display:flex; gap:10px; align-items:center; margin:10px 0}
  input[type="number"], select{
    background:#243024; color:var(--text); border:1px solid rgba(255,255,255,.18);
    border-radius:12px; padding:10px 12px; outline:none; width:100%;
  }
  input[type="number"]:focus, select:focus{
    border-color:rgba(46,125,50,.75); box-shadow:0 0 0 4px rgba(46,125,50,.22);
  }
  .btn{
    width:100%; padding:14px; border:0; border-radius:14px; cursor:pointer;
    font-weight:800; font-size:16px; color:#fff;
    background:linear-gradient(180deg,var(--green),var(--green-dark));
    box-shadow:0 12px 22px rgba(46,125,50,.35), inset 0 1px 0 rgba(255,255,255,.25);
  }

  /* Symptoms improved UI */
  .symptoms-box{background:#1e2a1e;border:1px solid rgba(255,255,255,.14);border-radius:14px;padding:10px}
  .sym-toolbar{display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:8px}
  #symSearch{flex:1; background:#243024; color:var(--text); border:1px solid rgba(255,255,255,.18); border-radius:12px; padding:10px 12px; outline:none}
  #symSearch:focus{ border-color:rgba(46,125,50,.75); box-shadow:0 0 0 4px rgba(46,125,50,.22) }
  .sym-count{font-size:13px; color:var(--muted); white-space:nowrap}
  .filter-tags{display:flex; gap:6px; flex-wrap:wrap}
  .tag{font-size:12px; padding:6px 10px; border-radius:999px; background:#243024; border:1px solid rgba(255,255,255,.18); cursor:pointer; user-select:none}
  .tag.active{outline:2px solid rgba(46,125,50,.3); background:#2a372a}
  .sym-actions{margin-inline-start:auto; display:flex; gap:6px}
  .mini-btn{background:#243024; color:var(--text); border:1px solid rgba(255,255,255,.18); border-radius:10px; padding:8px 10px; cursor:pointer}
  .sym-list{max-height:300px; overflow:auto; display:grid; gap:10px; padding:6px 2px}
  .group{border:1px solid rgba(255,255,255,.12); border-radius:12px; overflow:hidden}
  .group-h{background:#213021; padding:8px 12px; font-weight:800; font-size:14px; color:#cfe3cf; position:sticky; top:0}
  .group-b{padding:8px; display:grid; gap:8px}
  .sym-item{background:#243024;border:1px solid rgba(255,255,255,.14);border-radius:10px;padding:10px 12px;display:flex;align-items:center;justify-content:space-between;gap:10px;cursor:pointer;transition:background .15s,border-color .15s}
  .sym-item:hover{background:#2a372a;border-color:rgba(46,125,50,.45)}
  .sym-item.active{outline:3px solid rgba(46,125,50,.25); background:#2a372a}
  .sym-label{font-size:14px}
  .sym-meta{font-size:12px; opacity:.85}
  .chk{width:18px;height:18px;border-radius:4px;border:2px solid rgba(255,255,255,.6);display:inline-flex;align-items:center;justify-content:center;flex:0 0 18px}
  .chk svg{width:14px;height:14px;display:none}
  .sym-item.active .chk svg{display:block}
  footer{padding:12px 0 18px; text-align:center; font-size:12px; color:#e6efe6}
</style>
</head>
<body>

<header>
  <nav class="nav">
    <div class="brand">ğŸŒ± Ø§Ù„Ù…Ø²Ø§Ø±Ø¹</div>
    <a href="home.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <!-- Ø£Ù‡Ù… ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§ -->
    <a class="current" href="assess.html">ØªØ´Ø®ÙŠØµ</a>
    <!-- Ù‡Ø°Ù‡ Ù…Ø¤Ù‚ØªØ© ÙƒÙ…Ø³Ø§Ø±Ø§Øª Ø«Ø§Ø¨ØªØ© Ø¹Ø´Ø§Ù† Ù…Ø§ ØªØ¹Ù…Ù„ BuildError Ù„Ùˆ Ù…Ø§ Ø¹Ù†Ø¯Ùƒ Ø¨Ù„ÙˆØ¨Ø±Ù†Øª -->
    <a href="weather.html">Ø·Ù‚Ø³</a>
    <a href="yield.html">Ø¥Ù†ØªØ§Ø¬ÙŠØ©</a>
    <a href="assistant.html">Ù…Ø³Ø§Ø¹Ø¯</a>
    <a href="about.html">ØªØ¹Ø±ÙŠÙ</a>
    <span class="spacer"></span>
    <a href="profile.html">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
    <span class="sep">|</span>
    <a href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
    <span class="sep">|</span>
    <a href="register.html">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨</a>
    <span class="sep">|</span>
    <a href="{{ url_for('auth.logout') }}">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
  </nav>
</header>

<main>
  <div class="grid">
    <!-- Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª -->
    <section class="card">
      <h1>ØªØ´Ø®ÙŠØµ Ø²Ø±Ø§Ø¹ÙŠ</h1>
      <p class="hint">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ØŒ Ø­Ø¯Ù‘Ø¯ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…ØµØ§Ø¨ØŒ ÙˆØ£Ø¯Ø®Ù„ Ù…Ø¯Ø© Ø¸Ù‡ÙˆØ± Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶. Ø«Ù… Ø§Ø¶ØºØ· ØªØ´Ø®ÙŠØµ.</p>

      <!-- Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…ØµØ§Ø¨ -->
      <div class="section">
        <div class="section-title">Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…ØµØ§Ø¨</div>
        <div class="chips" id="partChips">
          <label class="chip active"><input type="radio" name="part" value="leaves" checked><span>Ø£ÙˆØ±Ø§Ù‚ ğŸƒ</span></label>
          <label class="chip"><input type="radio" name="part" value="roots"><span>Ø¬Ø°ÙˆØ± ğŸŒ±</span></label>
          <label class="chip"><input type="radio" name="part" value="stems"><span>Ø³Ø§Ù‚ ğŸŒ¿</span></label>
          <label class="chip"><input type="radio" name="part" value="fruits"><span>Ø«Ù…Ø§Ø± ğŸ…</span></label>
          <label class="chip"><input type="radio" name="part" value="flowers_buds"><span>Ø§Ù„Ø£Ø²Ù‡Ø§Ø± ÙˆØ§Ù„Ø¨Ø±Ø§Ø¹Ù… Ø§Ù„Ø²Ù‡Ø±ÙŠØ© ğŸŒ¸</span></label>
          <label class="chip"><input type="radio" name="part" value="soil_env"><span>Ø§Ù„ØªØ±Ø¨Ø©/Ø§Ù„Ø¨ÙŠØ¦Ø© ğŸ§ª</span></label>
        </div>
      </div>

      <!-- Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ -->
      <div class="section">
        <div class="section-title">Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶</div>

        <div class="symptoms-box">
          <div class="sym-toolbar">
            <input id="symSearch" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ø±Ø¶â€¦ (Ù…Ø«Ù„Ø§Ù‹: Ø§ØµÙØ±Ø§Ø±ØŒ Ø¨Ù‚Ø¹ØŒ Ø°Ø¨ÙˆÙ„)">
            <div class="filter-tags" id="tagBar">
              <span class="tag" data-tag="fungal">ÙØ·Ø±ÙŠ</span>
              <span class="tag" data-tag="bacterial">Ø¨ÙƒØªÙŠØ±ÙŠ</span>
              <span class="tag" data-tag="insect">Ø­Ø´Ø±ÙŠ</span>
              <span class="tag" data-tag="deficiency">Ù†Ù‚Øµ Ø¹Ù†Ø§ØµØ±</span>
              <span class="tag" data-tag="viral">ÙÙŠØ±ÙˆØ³ÙŠ</span>
              <span class="tag" data-tag="physio">ÙØ³ÙŠÙˆÙ„ÙˆØ¬ÙŠ/Ø¨ÙŠØ¦ÙŠ</span>
            </div>
            <div class="sym-actions">
              <button type="button" class="mini-btn" id="btnSelectAll">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
              <button type="button" class="mini-btn" id="btnClearAll">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
            </div>
            <span class="sym-count" id="symCount">0 Ù…Ø®ØªØ§Ø±Ø©</span>
          </div>

          <div id="symList" class="sym-list" role="listbox" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶"></div>
          <p class="hint" id="symHint">Ø§Ø®ØªØ± Ø¬Ø²Ø¡Ù‹Ø§ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø© Ø£Ø¹Ø±Ø§Ø¶ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡Ø§.</p>
        </div>
      </div>

      <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ø²Ù…Ù† -->
      <div class="section">
        <div class="section-title">Ù…Ù† ÙƒÙ… ÙŠÙˆÙ… Ø¨Ø¯Ø£Øª Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ØŸ</div>
        <div class="row">
          <input id="days" type="number" min="0" value="0" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…">
          <select id="growth">
            <option value="stable">Ù„Ø§ ØªØ²ÙŠØ¯</option>
            <option value="worse">ØªØ²Ø¯Ø§Ø¯ Ø³ÙˆØ¡Ù‹Ø§</option>
            <option value="improving">ØªØªØ­Ø³Ù†</option>
          </select>
        </div>
      </div>

      <button class="btn" id="diagnoseBtn">ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¢Ù†</button>
    </section>

    <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
    <section class="card" id="resultCard">
      <h2>Ø§Ù„Ù†ØªÙŠØ¬Ø©</h2>
      <div id="severity"></div>
      <div class="list" id="hypotheses"></div>
      <div class="tips" id="tips"></div>
      <div class="tips" id="alerts"></div>
    </section>
  </div>
</main>

<footer>khabab and ahmd @2025</footer>

<script>
  /* ========= ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ù…Ø¹ ØªØµÙ†ÙŠÙØ§Øª ÙØ±Ø¹ÙŠØ© + ÙˆØ³ÙˆÙ… ========= */
  // ÙƒÙ„ Ø¬Ø²Ø¡ ÙŠØ­ØªÙˆÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª (optgroup Ø¨ØµØ±ÙŠ) + items: {id,label,tags:[...]}
  const SYM = {
    leaves: {
      groups: {
        "Ù†Ù‚Øµ Ø¹Ù†Ø§ØµØ±": [
          {id:"yellow_leaves",label:"Ø£ÙˆØ±Ø§Ù‚ ØµÙØ±Ø§Ø¡",tags:["deficiency"]},
          {id:"interveinal_chlorosis",label:"Ø§ØµÙØ±Ø§Ø± Ø¨ÙŠÙ† Ø§Ù„Ø¹Ø±ÙˆÙ‚",tags:["deficiency"]},
          {id:"leaf_burn",label:"Ø­Ø±ÙˆÙ‚ Ø­ÙˆØ§Ù Ø§Ù„Ø£ÙˆØ±Ø§Ù‚",tags:["deficiency","physio"]},
          {id:"mottling",label:"ØªØ¨Ù‚Ø¹ Ù†Ù‚Øµ Ø¹Ù†Ø§ØµØ±",tags:["deficiency"]}
        ],
        "Ø£Ù…Ø±Ø§Ø¶ ÙØ·Ø±ÙŠØ©": [
          {id:"leaf_spots",label:"Ø¨Ù‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ (ÙØ·Ø±ÙŠ)",tags:["fungal"]},
          {id:"powdery",label:"Ø¨ÙˆØ¯Ø±Ø© Ø¨ÙŠØ¶Ø§Ø¡ (Ø¨ÙŠØ§Ø¶ Ø¯Ù‚ÙŠÙ‚ÙŠ)",tags:["fungal"]},
          {id:"downy",label:"Ø¹ÙÙ† Ø²ØºØ¨ÙŠ Ø±Ù…Ø§Ø¯ÙŠ",tags:["fungal"]},
          {id:"rust_leaf",label:"ØµØ¯Ø£ Ø£ÙˆØ±Ø§Ù‚",tags:["fungal"]}
        ],
        "Ø£Ù…Ø±Ø§Ø¶ Ø¨ÙƒØªÙŠØ±ÙŠØ©": [
          {id:"oily_lesions",label:"Ù„Ø·Ø®Ø§Øª Ø²ÙŠØªÙŠØ©",tags:["bacterial"]},
          {id:"water_soaked",label:"ØªØ¨Ù‚Ø¹Ø§Øª Ù…Ø§Ø¦ÙŠØ©",tags:["bacterial"]}
        ],
        "ÙÙŠØ±ÙˆØ³ÙŠØ©/Ø­Ø´Ø±ÙŠØ©": [
          {id:"mosaic",label:"Ù…ÙˆØ²Ø§ÙŠÙŠÙƒ/ØªØ¨Ù‚Ø¹ ÙÙŠØ±ÙˆØ³ÙŠ",tags:["viral"]},
          {id:"leaf_curl",label:"ØªØ¬Ø¹Ø¯ Ø£ÙˆØ±Ø§Ù‚ (ÙÙŠØ±ÙˆØ³/Ø¹Ù†Ø§ÙƒØ¨)",tags:["viral","insect"]},
          {id:"holes",label:"Ø«Ù‚ÙˆØ¨/ØªØºØ°ÙŠØ© Ø­Ø´Ø±ÙŠØ©",tags:["insect"]}
        ],
        "ÙØ³ÙŠÙˆÙ„ÙˆØ¬ÙŠØ©/Ø¨ÙŠØ¦ÙŠØ©": [
          {id:"necrosis",label:"Ù†Ø®Ø± Ù…ÙˆØ¶Ø¹ÙŠ",tags:["physio"]},
          {id:"sunburn_leaf",label:"Ø­Ø±Ù‚ Ø´Ù…Ø³",tags:["physio"]}
        ]
      }
    },
    roots: {
      groups: {
        "Ø£Ù…Ø±Ø§Ø¶ ÙØ·Ø±ÙŠØ©/Ø¨ÙƒØªÙŠØ±ÙŠØ©": [
          {id:"root_rot",label:"ØªØ¹ÙÙ† Ø§Ù„Ø¬Ø°ÙˆØ±",tags:["fungal"]},
          {id:"black_root",label:"Ø³ÙˆØ§Ø¯/ØªØ¹ÙÙ† Ø£Ø³ÙˆØ¯",tags:["fungal"]},
          {id:"ooze_root",label:"Ø¥ÙØ±Ø§Ø²Ø§Øª Ù„Ø²Ø¬Ø© (Ø¨ÙƒØªÙŠØ±ÙŠ)",tags:["bacterial"]}
        ],
        "Ù†Ù‚Øµ Ø¹Ù†Ø§ØµØ±/Ø¨Ù†ÙŠØ©": [
          {id:"root_browning",label:"Ø§Ø³Ù…Ø±Ø§Ø± Ø§Ù„Ø¬Ø°ÙˆØ±",tags:["deficiency"]},
          {id:"stunted_roots",label:"Ø¶Ø¹Ù/Ù‚ØµØ± Ø§Ù„Ø¬Ø°ÙˆØ±",tags:["deficiency","physio"]},
          {id:"poor_root_hairs",label:"Ù‚Ù„Ø© Ø§Ù„Ø´Ø¹ÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø°Ø±ÙŠØ©",tags:["deficiency"]}
        ],
        "Ø­Ø´Ø±ÙŠØ©": [
          {id:"root_nematodes",label:"Ø¹Ù‚Ø¯/Ø§Ù†ØªÙØ§Ø® Ù†ÙŠÙ…Ø§ØªÙˆØ¯Ø§",tags:["insect"]}
        ],
        "ÙØ³ÙŠÙˆÙ„ÙˆØ¬ÙŠØ©": [
          {id:"root_cracks",label:"ØªØ´Ù‚Ù‚Ø§Øª Ø§Ù„Ø¬Ø°ÙˆØ±",tags:["physio"]}
        ]
      }
    },
    stems: {
      groups: {
        "ÙØ·Ø±ÙŠ": [
          {id:"stem_rust",label:"ØµØ¯Ø£ Ø§Ù„Ø³Ø§Ù‚",tags:["fungal"]},
          {id:"stem_lesions",label:"ØªÙ‚Ø±ÙˆØ­/ØªØ¨Ù‚Ø¹ Ø³Ø§Ù‚",tags:["fungal"]}
        ],
        "Ø¨ÙƒØªÙŠØ±ÙŠ": [
          {id:"ooze",label:"Ù†Ø²Ù‘ Ø¥ÙØ±Ø§Ø²Ø§Øª Ø¨ÙƒØªÙŠØ±ÙŠØ©",tags:["bacterial"]}
        ],
        "Ø­Ø´Ø±ÙŠ/Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ": [
          {id:"girdling",label:"Ø§Ø®ØªÙ†Ø§Ù‚ Ø§Ù„Ø³Ø§Ù‚",tags:["physio"]},
          {id:"stem_cracks",label:"ØªØ´Ù‚Ù‚ Ø§Ù„Ø³Ø§Ù‚",tags:["physio"]},
          {id:"borer_damage",label:"Ø£Ù†ÙØ§Ù‚ Ø­ÙÙ‘Ø§Ø±Ø§Øª",tags:["insect"]}
        ],
        "Ø°Ø¨ÙˆÙ„/ÙØ³ÙŠÙˆÙ„ÙˆØ¬ÙŠ": [
          {id:"wilting",label:"Ø°Ø¨ÙˆÙ„ Ù…ÙØ§Ø¬Ø¦",tags:["physio"]},
          {id:"lodging",label:"Ø±Ù‚Ø§Ø¯/Ø¶Ø¹Ù",tags:["physio"]}
        ]
      }
    },
    fruits: {
      groups: {
        "ÙØ·Ø±ÙŠ/Ø¨ÙƒØªÙŠØ±ÙŠ": [
          {id:"fruit_spots",label:"Ø¨Ù‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø«Ù…Ø§Ø±",tags:["fungal","bacterial"]},
          {id:"fruit_rot",label:"ØªØ¹ÙÙ† Ø«Ù…Ø§Ø±",tags:["fungal"]},
          {id:"oily_fruit",label:"Ù„Ø·Ø®Ø§Øª Ù…Ø§Ø¦ÙŠØ©/Ø¯Ù‡Ù†ÙŠØ©",tags:["bacterial"]}
        ],
        "ÙØ³ÙŠÙˆÙ„ÙˆØ¬ÙŠ": [
          {id:"cracking",label:"ØªØ´Ù‚Ù‚ Ø§Ù„Ø«Ù…Ø§Ø±",tags:["physio"]},
          {id:"sunscald",label:"Ù„Ø³Ø¹Ø© Ø´Ù…Ø³",tags:["physio"]},
          {id:"blossom_end_rot",label:"ØªØ¹ÙÙ† Ø§Ù„Ù‚Ù…Ø© Ø§Ù„Ø²Ù‡Ø±ÙŠØ©",tags:["deficiency","physio"]},
          {id:"internal_browning",label:"Ø§Ø³Ù…Ø±Ø§Ø± Ø¯Ø§Ø®Ù„ÙŠ",tags:["physio"]}
        ],
        "ØªÙ„Ù‚ÙŠØ­/ÙÙŠØ±ÙˆØ³": [
          {id:"deformed_fruits",label:"ØªØ´ÙˆÙ‡ Ø§Ù„Ø«Ù…Ø§Ø±",tags:["viral","physio"]}
        ]
      }
    },
    flowers_buds: {
      groups: {
        "ØªÙ„Ù‚ÙŠØ­/Ø­Ø±Ø§Ø±Ø©": [
          {id:"flower_drop",label:"ØªØ³Ø§Ù‚Ø· Ø§Ù„Ø£Ø²Ù‡Ø§Ø±",tags:["physio"]},
          {id:"poor_fruit_set",label:"Ø¹Ù‚Ø¯ Ø«Ù…Ø±ÙŠ Ø¶Ø¹ÙŠÙ",tags:["physio"]},
          {id:"pollen_issue",label:"Ø¶Ø¹Ù Ø­Ø¨ÙˆØ¨ Ø§Ù„Ù„Ù‚Ø§Ø­",tags:["physio"]}
        ],
        "ÙØ·Ø±ÙŠ/ÙÙŠØ±ÙˆØ³ÙŠ": [
          {id:"bud_blight",label:"Ù„ÙØ­Ø© Ø¨Ø±Ø§Ø¹Ù…",tags:["fungal"]},
          {id:"deformed_flowers",label:"ØªØ´ÙˆÙ‡ Ø§Ù„Ø£Ø²Ù‡Ø§Ø± (ÙÙŠØ±ÙˆØ³ÙŠ)",tags:["viral"]}
        ],
        "ÙØ³ÙŠÙˆÙ„ÙˆØ¬ÙŠ": [
          {id:"bud_dieback",label:"Ø¬ÙØ§Ù Ø§Ù„Ø¨Ø±Ø§Ø¹Ù…",tags:["physio"]},
          {id:"flower_necrosis",label:"Ù†Ø®Ø± Ø²Ù‡Ø±ÙŠ",tags:["physio"]}
        ]
      }
    },
    soil_env: {
      groups: {
        "ØªØ±Ø¨Ø©/Ù…Ø§Ø¡": [
          {id:"salinity_signs",label:"Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ù„ÙˆØ­Ø© (Ù‚Ø´Ø±Ø©/Ø°Ø¨ÙˆÙ„)",tags:["physio"]},
          {id:"waterlogging",label:"ØªØºØ¯Ù‚/ØªØ´Ø¨Ø¹ Ù…Ø§Ø¡",tags:["physio"]},
          {id:"ph_issue",label:"Ù…Ø´Ø§ÙƒÙ„ pH (Ù‚Ù„ÙˆÙŠØ©/Ø­Ù…ÙˆØ¶Ø©)",tags:["physio"]}
        ],
        "Ù…Ù†Ø§Ø®/Ø±ÙŠØ§Ø­": [
          {id:"cold_stress",label:"Ø¥Ø¬Ù‡Ø§Ø¯ Ø¨Ø±ÙˆØ¯Ø©",tags:["physio"]},
          {id:"heat_stress",label:"Ø¥Ø¬Ù‡Ø§Ø¯ Ø­Ø±Ø§Ø±Ø©",tags:["physio"]},
          {id:"wind_damage",label:"Ø¶Ø±Ø± Ø±ÙŠØ§Ø­/Ø±Ù…Ù„",tags:["physio"]}
        ],
        "ØªØºØ°ÙŠØ© Ø¹Ø§Ù…Ø©": [
          {id:"nutrient_def_mix",label:"Ù†Ù‚Øµ Ø¹Ù†Ø§ØµØ± Ù…Ø±ÙƒÙ‘Ø¨",tags:["deficiency"]},
          {id:"general_stunting",label:"ØªÙ‚Ø²Ù‘Ù… Ø¹Ø§Ù…",tags:["deficiency","physio"]}
        ]
      }
    }
  };

  /* ========= Ø­Ø§Ù„Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ ========= */
  let currentPart = 'leaves';
  let activeTags = new Set(); // ÙÙ„Ø§ØªØ± Ø§Ù„ÙˆØ³ÙˆÙ…
  const symListEl = document.getElementById('symList');
  const symSearchEl = document.getElementById('symSearch');
  const symCountEl = document.getElementById('symCount');
  const tagBar = document.getElementById('tagBar');

  // Ø¨Ù†Ø§Ø¡ Ø¹Ù†ØµØ± Ø¹Ø±Ø¶
  function makeSymItem(item){
    const div = document.createElement('div');
    div.className = 'sym-item';
    div.dataset.id = item.id;
    div.dataset.tags = item.tags.join(',');
    div.innerHTML = `
      <div>
        <div class="sym-label">${item.label}</div>
        <div class="sym-meta">${item.tags.map(t=>tagLabel(t)).join(' Â· ')}</div>
      </div>
      <span class="chk" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </span>`;
    div.addEventListener('click', ()=>{ div.classList.toggle('active'); updateSelectedCount(); });
    return div;
  }

  function tagLabel(t){
    return {
      fungal:'ÙØ·Ø±ÙŠ', bacterial:'Ø¨ÙƒØªÙŠØ±ÙŠ', insect:'Ø­Ø´Ø±ÙŠ',
      deficiency:'Ù†Ù‚Øµ Ø¹Ù†Ø§ØµØ±', viral:'ÙÙŠØ±ÙˆØ³ÙŠ', physio:'ÙØ³ÙŠÙˆÙ„ÙˆØ¬ÙŠ/Ø¨ÙŠØ¦ÙŠ'
    }[t] || t;
  }

  // Ø±Ø³Ù… Ù…Ø¬Ù…ÙˆØ¹Ø© (optgroup Ø¨ØµØ±ÙŠ)
  function makeGroup(title, items){
    const box = document.createElement('div'); box.className='group';
    const h = document.createElement('div'); h.className='group-h'; h.textContent = title;
    const b = document.createElement('div'); b.className='group-b';
    items.forEach(it=>b.appendChild(makeSymItem(it)));
    box.appendChild(h); box.appendChild(b);
    return box;
  }

  // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙˆØ³ÙˆÙ…
  function filterItems(items){
    const q = (symSearchEl.value||'').trim();
    const tagFilterActive = activeTags.size>0;
    return items.filter(it=>{
      const okQuery = !q || it.label.includes(q) || it.id.includes(q);
      const okTags = !tagFilterActive || it.tags.some(t=>activeTags.has(t));
      return okQuery && okTags;
    });
  }

  // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
  function renderSymptoms(){
    symListEl.innerHTML = '';
    const part = SYM[currentPart]; if(!part){ return; }
    const groups = part.groups;
    let total = 0;
    Object.keys(groups).forEach(g=>{
      const filtered = filterItems(groups[g]);
      if(filtered.length){
        symListEl.appendChild(makeGroup(g, filtered));
        total += filtered.length;
      }
    });
    document.getElementById('symHint').textContent = total? "Ø§Ø®ØªØ± Ø¹Ø±Ø¶Ù‹Ø§ Ø£Ùˆ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©." : "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¹Ø±Ø§Ø¶ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ÙÙ„ØªØ±.";
    updateSelectedCount();
  }

  // Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø§Øª
  function updateSelectedCount(){
    symCountEl.textContent = `${document.querySelectorAll('#symList .sym-item.active').length} Ù…Ø®ØªØ§Ø±Ø©`;
  }

  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„/Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
  document.getElementById('btnSelectAll').addEventListener('click', ()=>{
    document.querySelectorAll('#symList .sym-item').forEach(el=>el.classList.add('active'));
    updateSelectedCount();
  });
  document.getElementById('btnClearAll').addEventListener('click', ()=>{
    document.querySelectorAll('#symList .sym-item').forEach(el=>el.classList.remove('active'));
    updateSelectedCount();
  });

  // Ø¨Ø­Ø« ÙÙˆØ±ÙŠ
  symSearchEl.addEventListener('input', renderSymptoms);

  // ÙÙ„ØªØ± Ø§Ù„ÙˆØ³ÙˆÙ…
  tagBar.addEventListener('click', (e)=>{
    const tag = e.target.closest('.tag'); if(!tag) return;
    const key = tag.dataset.tag;
    if(tag.classList.toggle('active')) activeTags.add(key);
    else activeTags.delete(key);
    renderSymptoms();
  });

  // ØªÙØ¹ÙŠÙ„ ØªØºÙŠÙŠØ± Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…ØµØ§Ø¨ (event delegation Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§ÙˆÙŠØ© â€” Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø¹Ø¯Ù… Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©)
  document.getElementById('partChips').addEventListener('click', (e)=>{
    const chip = e.target.closest('.chip'); if(!chip) return;
    const input = chip.querySelector('input[type="radio"]');
    if(!input) return;
    input.checked = true;
    document.querySelectorAll('#partChips .chip').forEach(c=>c.classList.remove('active'));
    chip.classList.add('active');
    currentPart = input.value;
    renderSymptoms();
  });

  // ØªØ¹Ø¨Ø¦Ø© Ø£ÙˆÙ„ÙŠØ©
  window.addEventListener('DOMContentLoaded', ()=>{
    renderSymptoms();
  });

  /* ========= Ù‚Ø§Ø¹Ø¯Ø© Ù…Ø¨Ø³Ø·Ø© (ÙƒÙ…Ø§ ÙƒØ§Ù†Øª Ù…Ø¹ ØªÙˆØ³Ø¹Ø§Øª Ø·ÙÙŠÙØ©) ========= */
  const knowledge = {
    yellow_leaves:{diseases:{nitrogen_def:0.7}, tips:["Ø£Ø¶Ù Ù†ÙŠØªØ±ÙˆØ¬ÙŠÙ†","Ø²Ø¯ Ø§Ù„Ø±ÙŠ ÙŠÙˆÙ…ÙŠÙ† Ø¨Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹"]},
    interveinal_chlorosis:{diseases:{iron_def:0.6, magnesium_def:0.4}, tips:["Ø±Ø´ Ø­Ø¯ÙŠØ¯ Ù…Ø®Ù„Ø¨","ØªÙˆØ§Ø²Ù† Ø³Ù…Ø§Ø¯ÙŠ"]},
    leaf_burn:{diseases:{salt_burn:0.5}, tips:["ØºØ³ÙŠÙ„ Ø£Ù…Ù„Ø§Ø­","ØªØ¸Ù„ÙŠÙ„"]},
    mottling:{diseases:{deficiency:1.0}, tips:["ØªØ­Ù„ÙŠÙ„ ÙˆØ±Ù‚ÙŠ","Ø®Ø·Ø© ØªØºØ°ÙŠØ©"]},
    leaf_spots:{diseases:{leaf_spot_fungus:0.7}, tips:["Ù…Ø¨ÙŠØ¯ ÙØ·Ø±ÙŠ Ø¹Ø¶ÙˆÙŠ","ØªÙ‡ÙˆÙŠØ©"]},
    powdery:{diseases:{powdery_mildew:0.8}, tips:["Ù…Ø¨ÙŠØ¯ Ø¨ÙŠØ§Ø¶ Ø¯Ù‚ÙŠÙ‚ÙŠ","ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø±Ø·ÙˆØ¨Ø©"]},
    downy:{diseases:{downy_mildew:0.8}, tips:["Ù…Ø¨ÙŠØ¯ Ø²ØºØ¨ÙŠ","ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙ‡ÙˆÙŠØ©"]},
    rust_leaf:{diseases:{rust:1.0}, tips:["Ù…Ø¨ÙŠØ¯ ØµØ¯Ø£","Ø£ØµÙ†Ø§Ù Ù…Ù‚Ø§ÙˆÙ…Ø©"]},
    oily_lesions:{diseases:{bacterial_blight:1.0}, tips:["Ù…Ø¨ÙŠØ¯ Ø¨ÙƒØªÙŠØ±ÙŠ","ØªØ¬Ù†Ø¨ Ø§Ù„Ø¨Ù„Ù„ Ø§Ù„Ù„ÙŠÙ„ÙŠ"]},
    water_soaked:{diseases:{bacterial_spot:1.0}, tips:["Ù†Ø­Ø§Ø³ÙŠ Ø®ÙÙŠÙ","ØªØ¹Ù‚ÙŠÙ… Ø£Ø¯ÙˆØ§Øª"]},
    mosaic:{diseases:{viral_mosaic:1.0}, tips:["Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¨","Ù…ÙƒØ§ÙØ­Ø© Ù†ÙˆØ§Ù‚Ù„"]},
    leaf_curl:{diseases:{virus:0.6, mites:0.4}, tips:["Ù…ÙƒØ§ÙØ­Ø© Ù†ÙˆØ§Ù‚Ù„/Ø¹Ù†Ø§ÙƒØ¨"]},
    holes:{diseases:{chewing_insects:1.0}, tips:["Ù…ØµØ§Ø¦Ø¯ Ø¶ÙˆØ¦ÙŠØ©","Ù…Ø¨ÙŠØ¯ Ù…Ø±Ø®Ù‘Øµ"]},
    necrosis:{diseases:{necrosis:1.0}, tips:["Ù‚Øµ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…ÙŠØªØ©","ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØºØ°ÙŠØ©"]},
    sunburn_leaf:{diseases:{sunscald:1.0}, tips:["ØªØ¸Ù„ÙŠÙ„","Ø±ÙŠ Ù…Ù†ØªØ¸Ù…"]},

    root_rot:{diseases:{root_fungus:0.8}, tips:["Ù…Ø¨ÙŠØ¯ ØªØ±Ø¨Ø© ÙØ·Ø±ÙŠ","Ø®ÙØ¶ Ø§Ù„Ø±ÙŠ"]},
    black_root:{diseases:{black_root:1.0}, tips:["ØµØ±Ù Ø¬ÙŠØ¯","ØªØ¹Ù‚ÙŠÙ…"]},
    ooze_root:{diseases:{bacterial_wilt:1.0}, tips:["ØªØ¹Ù‚ÙŠÙ… Ø§Ù„Ø£Ø¯ÙˆØ§Øª","Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø·ÙˆØ¨Ø©"]},
    root_browning:{diseases:{root_deficiency:0.5}, tips:["ØªØ­Ø³ÙŠÙ† Ø§Ù„ØµØ±Ù","ØªÙˆØ§Ø²Ù† Ø³Ù…Ø§Ø¯ÙŠ"]},
    stunted_roots:{diseases:{ph_compaction:0.5}, tips:["ØªÙ‡ÙˆÙŠØ© Ø§Ù„ØªØ±Ø¨Ø©","ØªØ­Ù„ÙŠÙ„ ØªØ±Ø¨Ø©"]},
    poor_root_hairs:{diseases:{deficiency:1.0}, tips:["ÙÙˆØ³ÙÙˆØ±/Ø²Ù†Ùƒ"]},
    root_nematodes:{diseases:{root_nematodes:1.0}, tips:["Ø¯ÙˆØ±Ø§Øª Ø²Ø±Ø§Ø¹ÙŠØ©","Ù…Ø¨ÙŠØ¯ Ù†ÙŠÙ…Ø§ØªÙˆØ¯Ø§"]},
    root_cracks:{diseases:{drought:0.6, calcium_def:0.4}, tips:["ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø±ÙŠ","ÙƒØ§Ù„Ø³ÙŠÙˆÙ…"]},

    stem_rust:{diseases:{stem_rust:1.0}, tips:["Ù…Ø¨ÙŠØ¯ ØµØ¯Ø£"]},
    stem_lesions:{diseases:{stem_canker:1.0}, tips:["ØªÙ‚Ù„ÙŠÙ… ØµØ­ÙŠ"]},
    ooze:{diseases:{bacterial_wilt:1.0}, tips:["ØªØ¹Ù‚ÙŠÙ… Ø§Ù„Ø£Ø¯ÙˆØ§Øª"]},
    girdling:{diseases:{mechanical:1.0}, tips:["Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø§Ø· Ø§Ù„Ø¶Ø§Ø±"]},
    stem_cracks:{diseases:{irrigation_irregular:0.8}, tips:["ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø±ÙŠ"]},
    borer_damage:{diseases:{borer:1.0}, tips:["Ù…ØµØ§Ø¦Ø¯ ÙØ±Ù…ÙˆÙ†ÙŠØ©","Ø¥Ø²Ø§Ù„Ø© Ø¨Ø¤Ø± Ø§Ù„Ø¥ØµØ§Ø¨Ø©"]},
    wilting:{diseases:{vascular_wilt:0.8}, tips:["ÙØ­Øµ Ø§Ù„Ø§Ù†Ø³Ø¯Ø§Ø¯ Ø§Ù„ÙˆØ¹Ø§Ø¦ÙŠ","Ø±ÙŠ Ù…Ù†ØªØ¸Ù…"]},
    lodging:{diseases:{weak_stem:1.0}, tips:["Ø¨ÙˆØªØ§Ø³ÙŠÙˆÙ…","Ø¯Ø¹Ø§Ù…Ø§Øª"]},

    fruit_spots:{diseases:{anthracnose:0.6, bacterial_spot:0.4}, tips:["Ù†Ø­Ø§Ø³ÙŠ Ø®ÙÙŠÙ","ØªÙ‡ÙˆÙŠØ©"]},
    fruit_rot:{diseases:{fruit_rot_fungus:0.7}, tips:["ØªØ¹Ù‚ÙŠÙ… Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù‚Ø·Ù","Ø­ØµØ§Ø¯ Ù…Ø¨ÙƒØ±"]},
    oily_fruit:{diseases:{bacterial_blight:1.0}, tips:["Ù…Ø¶Ø§Ø¯ Ø¨ÙƒØªÙŠØ±ÙŠ"]},
    cracking:{diseases:{irrigation_irregular:0.8}, tips:["ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø±ÙŠ","ÙƒØ§Ù„Ø³ÙŠÙˆÙ…"]},
    sunscald:{diseases:{sunscald:1.0}, tips:["ØªØ¸Ù„ÙŠÙ„"]},
    blossom_end_rot:{diseases:{calcium_def:1.0}, tips:["ÙƒØ§Ù„Ø³ÙŠÙˆÙ… Ù…Ù†ØªØ¸Ù…"]},
    internal_browning:{diseases:{heat_stress:1.0}, tips:["ØªØ¨Ø±ÙŠØ¯ Ø³Ø±ÙŠØ¹ Ø¨Ø¹Ø¯ Ø§Ù„Ø­ØµØ§Ø¯"]},
    deformed_fruits:{diseases:{pollination_issue:1.0}, tips:["Ø¬Ø°Ø¨ Ù…Ù„Ù‚Ø­Ø§Øª"]},

    flower_drop:{diseases:{heat_stress:0.6}, tips:["ØªØ¸Ù„ÙŠÙ„","Ø±Ø´ ÙƒØ§Ù„Ø³ÙŠÙˆÙ…/Ø¨ÙˆØ±ÙˆÙ†"]},
    poor_fruit_set:{diseases:{pollination_issue:1.0}, tips:["Ø¬Ø°Ø¨ Ù…Ù„Ù‚Ø­Ø§Øª"]},
    pollen_issue:{diseases:{pollen_issue:1.0}, tips:["Ø±Ø·ÙˆØ¨Ø© Ù…Ø¹ØªØ¯Ù„Ø©"]},
    bud_blight:{diseases:{bud_blight:1.0}, tips:["Ù…Ø¨ÙŠØ¯ ÙØ·Ø±ÙŠ"]},
    deformed_flowers:{diseases:{virus:1.0}, tips:["Ù…ÙƒØ§ÙØ­Ø© Ù†ÙˆØ§Ù‚Ù„"]},
    bud_dieback:{diseases:{dieback:1.0}, tips:["ØªÙ‚Ù„ÙŠÙ… ØµØ­ÙŠ"]},
    flower_necrosis:{diseases:{flower_necrosis:1.0}, tips:["ØªØ¹Ù‚ÙŠÙ… Ø§Ù„Ø£Ø¯ÙˆØ§Øª"]},

    salinity_signs:{diseases:{salinity:1.0}, tips:["ØºØ³ÙŠÙ„ Ø£Ù…Ù„Ø§Ø­"]},
    waterlogging:{diseases:{waterlogging:1.0}, tips:["ØªØ­Ø³ÙŠÙ† Ø§Ù„ØµØ±Ù"]},
    ph_issue:{diseases:{ph_issue:1.0}, tips:["ØªØ¹Ø¯ÙŠÙ„ pH"]},
    cold_stress:{diseases:{cold_stress:1.0}, tips:["ØªØ¯ÙØ¦Ø©/ØªØºØ·ÙŠØ©"]},
    heat_stress:{diseases:{heat_stress:1.0}, tips:["ØªØ¸Ù„ÙŠÙ„ ÙˆØ¶Ø¨Ø· Ø±ÙŠ"]},
    wind_damage:{diseases:{wind_damage:1.0}, tips:["Ù…ØµØ¯Ø§Øª Ø±ÙŠØ§Ø­"]},
    nutrient_def_mix:{diseases:{nutrient_def_mix:1.0}, tips:["Ø®Ø·Ø© ØªØºØ°ÙŠØ© Ø´Ø§Ù…Ù„Ø©"]},
    general_stunting:{diseases:{general_stunting:1.0}, tips:["ØªØ³Ù…ÙŠØ¯ Ù…ØªÙˆØ§Ø²Ù†","ØªØ­Ø³ÙŠÙ† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ÙŠ"]}
  };

  const diseaseLabels = {
    nitrogen_def:"Ù†Ù‚Øµ Ù†ÙŠØªØ±ÙˆØ¬ÙŠÙ†", iron_def:"Ù†Ù‚Øµ Ø­Ø¯ÙŠØ¯", magnesium_def:"Ù†Ù‚Øµ Ù…ØºÙ†ÙŠØ³ÙŠÙˆÙ…",
    salt_burn:"Ø­Ø±Ù‚ Ø£Ù…Ù„Ø§Ø­", deficiency:"Ù†Ù‚Øµ Ø¹Ù†Ø§ØµØ±", leaf_spot_fungus:"Ø¨Ù‚Ø¹ Ø£ÙˆØ±Ø§Ù‚ (ÙØ·Ø±ÙŠ)",
    powdery_mildew:"Ø¨ÙŠØ§Ø¶ Ø¯Ù‚ÙŠÙ‚ÙŠ", downy_mildew:"Ø¹ÙÙ† Ø²ØºØ¨ÙŠ", rust:"ØµØ¯Ø£ Ø£ÙˆØ±Ø§Ù‚",
    bacterial_blight:"Ù„ÙØ­Ø© Ø¨ÙƒØªÙŠØ±ÙŠØ©", bacterial_spot:"Ø¨Ù‚Ø¹ Ø¨ÙƒØªÙŠØ±ÙŠØ©",
    viral_mosaic:"ÙÙŠØ±ÙˆØ³ Ù…ÙˆØ²Ø§ÙŠÙŠÙƒ", virus:"ÙÙŠØ±ÙˆØ³", mites:"Ø¹Ù†Ø§ÙƒØ¨",
    chewing_insects:"Ø­Ø´Ø±Ø§Øª Ù‚Ø§Ø¶Ù…Ø©", necrosis:"Ù†Ø®Ø±", sunscald:"Ù„Ø³Ø¹Ø© Ø´Ù…Ø³",
    root_fungus:"ÙØ·Ø± Ø¬Ø°ÙˆØ±", black_root:"ØªØ¹ÙÙ† Ø£Ø³ÙˆØ¯", bacterial_wilt:"Ø°Ø¨ÙˆÙ„ Ø¨ÙƒØªÙŠØ±ÙŠ",
    root_deficiency:"Ù†Ù‚Øµ Ø¹Ù†Ø§ØµØ± Ø¨Ø§Ù„Ø¬Ø°ÙˆØ±", ph_compaction:"ØªØ±Ø¨Ø© Ù…Ø¶ØºÙˆØ·Ø©/Ø­Ù…ÙˆØ¶Ø© ØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨Ø©",
    root_nematodes:"Ù†ÙŠÙ…Ø§ØªÙˆØ¯Ø§ Ø§Ù„Ø¬Ø°ÙˆØ±", drought:"Ø¬ÙØ§Ù", calcium_def:"Ù†Ù‚Øµ ÙƒØ§Ù„Ø³ÙŠÙˆÙ…",
    stem_rust:"ØµØ¯Ø£ Ø§Ù„Ø³Ø§Ù‚", stem_canker:"ÙƒØ§Ù†ÙƒØ± Ø§Ù„Ø³Ø§Ù‚", mechanical:"Ø¶Ø±Ø± Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ",
    irrigation_irregular:"Ø¹Ø¯Ù… Ø§Ù†ØªØ¸Ø§Ù… Ø§Ù„Ø±ÙŠ", borer:"Ø­ÙÙ‘Ø§Ø± Ø§Ù„Ø³Ø§Ù‚", vascular_wilt:"Ø°Ø¨ÙˆÙ„ ÙˆØ¹Ø§Ø¦ÙŠ",
    weak_stem:"Ø³Ø§Ù‚ Ø¶Ø¹ÙŠÙ", anthracnose:"Ø£Ù†Ø«Ø±Ø§ÙƒÙ†ÙˆØ²", fruit_rot_fungus:"ØªØ¹ÙÙ† ÙØ·Ø±ÙŠ",
    pollination_issue:"Ù…Ø´ÙƒÙ„Ø© ØªÙ„Ù‚ÙŠØ­", dieback:"Ø¬ÙØ§Ù Ù‚Ù…Ù…ÙŠ", flower_necrosis:"Ù†Ø®Ø± Ø²Ù‡Ø±ÙŠ",
    salinity:"Ù…Ù„ÙˆØ­Ø©", waterlogging:"ØªØºØ¯Ù‚", ph_issue:"Ø®Ù„Ù„ pH",
    cold_stress:"Ø¥Ø¬Ù‡Ø§Ø¯ Ø¨Ø±ÙˆØ¯Ø©", heat_stress:"Ø¥Ø¬Ù‡Ø§Ø¯ Ø­Ø±Ø§Ø±Ø©", wind_damage:"Ø¶Ø±Ø± Ø±ÙŠØ§Ø­/Ø±Ù…Ù„",
    nutrient_def_mix:"Ù†Ù‚Øµ Ø¹Ù†Ø§ØµØ± Ù…Ø±ÙƒÙ‘Ø¨", general_stunting:"ØªÙ‚Ø²Ù‘Ù… Ø¹Ø§Ù…"
  };

  const severeKeywords = new Set(["wilting","root_rot","fruit_rot","bacterial_wilt","waterlogging","sunscald","stem_canker"]);

  /* ========= ØªØ´Ø®ÙŠØµ ========= */
  document.getElementById('diagnoseBtn').addEventListener('click', ()=>{
    const selected = [...document.querySelectorAll('#symList .sym-item.active')].map(el=>el.dataset.id);
    const days = Math.max(0, parseInt(document.getElementById('days').value||'0',10));
    const trend = document.getElementById('growth').value;

    let diseaseScores = {}, tipsSet = new Set();
    selected.forEach(id=>{
      const info = knowledge[id]; if(!info) return;
      Object.entries(info.diseases).forEach(([d,p])=> diseaseScores[d]=(diseaseScores[d]||0)+p );
      (info.tips||[]).forEach(t=>tipsSet.add(t));
    });

    let severityBase = selected.length + (days>=7?1:0) + (trend==="worse"?1:0) - (trend==="improving"?1:0);
    const hasSevere = selected.some(s=>severeKeywords.has(s));
    if(hasSevere) severityBase += 1.5;

    let sevLabel, sevClass, sevEmoji;
    if(severityBase<=1){ sevLabel="Ø®ÙÙŠÙ"; sevClass="b-light"; sevEmoji="ğŸŒ±"; }
    else if(severityBase<=3){ sevLabel="Ù…ØªÙˆØ³Ø·"; sevClass="b-med"; sevEmoji="ğŸŒ¾"; }
    else{ sevLabel="Ø´Ø¯ÙŠØ¯"; sevClass="b-high"; sevEmoji="ğŸš¨"; }

    const entries = Object.entries(diseaseScores).sort((a,b)=>b[1]-a[1]).slice(0,3);
    const sum = entries.reduce((a,c)=>a+c[1],0)||1;
    const probs = entries.map(([k,v])=>[k,Math.round((v/sum)*100)]);

    const sevDiv = document.getElementById('severity');
    const hypDiv = document.getElementById('hypotheses');
    const tipsDiv = document.getElementById('tips');
    const alertsDiv = document.getElementById('alerts');
    sevDiv.innerHTML = hypDiv.innerHTML = tipsDiv.innerHTML = alertsDiv.innerHTML = "";

    if(selected.length===0){
      sevDiv.innerHTML=`<span class="hint">Ø§Ø®ØªØ± Ø£Ø¹Ø±Ø§Ø¶Ù‹Ø§ Ø£ÙˆÙ„Ù‹Ø§.</span>`; return;
    }

    sevDiv.innerHTML = `<span class="badge ${sevClass}">${sevEmoji} Ø´Ø¯Ø© Ø§Ù„Ø¥ØµØ§Ø¨Ø©: <strong>${sevLabel}</strong></span>`;
    hypDiv.innerHTML = probs.map(([k,p])=>
      `<div class="li"><div><strong>${diseaseLabels[k]||k}</strong></div><div class="pct">${p}%</div></div>`
    ).join('') || `<div class="li"><div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ù…Ø·Ø§Ø¨Ù‚Ø© Ù…Ø¨Ø§Ø´Ø±Ø©ØŒ Ø±Ø§Ù‚Ø¨ Ø§Ù„Ù†Ø¨Ø§Øª.</div><div class="pct">â€”</div></div>`;

    tipsDiv.innerHTML = `<h2>Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¹Ù„Ø§Ø¬</h2>` + [...tipsSet].slice(0,6).map(t=>`<div class="tip">âœ”ï¸ ${t}</div>`).join('');
    if(days<=2 && trend!=="worse"){ tipsDiv.innerHTML += `<div class="tip">ğŸ‘€ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø¬Ø¯ÙŠØ¯Ø©: ØªØ§Ø¨Ø¹ ÙŠÙˆÙ…ÙŠÙ† Ù‚Ø¨Ù„ Ø¹Ù„Ø§Ø¬ Ù‚ÙˆÙŠ.</div>`; }
    else if(days>10 || trend==="worse"){ tipsDiv.innerHTML += `<div class="tip">ğŸ§ª Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ù…Ù…ØªØ¯Ø©/ØªØ²Ø¯Ø§Ø¯: ØªØ­Ù„ÙŠÙ„ ØªØ±Ø¨Ø©/Ø£ÙˆØ±Ø§Ù‚ ÙˆØ¹Ù„Ø§Ø¬ Ø£Ù‚ÙˆÙ‰.</div>`; }

    if(hasSevere){ alertsDiv.innerHTML = `<div class="tip warn">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: ØªÙˆØ¬Ø¯ Ø£Ø¹Ø±Ø§Ø¶ Ù‚Ø¯ ØªÙƒÙˆÙ† Ø®Ø·ÙŠØ±Ø©. ØªØ­Ø±Ù‘Ùƒ Ø¨Ø³Ø±Ø¹Ø© ÙˆØ§Ø³ØªØ®Ø¯Ù… Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ù…Ù†Ø§Ø³Ø¨Ø© ÙˆÙ‚Ù„Ù‘Ù„ Ø§Ù„Ø±ÙŠ.</div>`; }
  });
</script>
</body>
</html>
