<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ â€” ÙˆØ§Ø¬Ù‡Ø© Ù…ÙˆØ­Ù‘Ø¯Ø© (Index ÙˆØ§Ø­Ø¯)</title>
  <!-- Bootstrap RTL -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <!-- Tajawal font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;800&display=swap" rel="stylesheet">
  <!-- Three.js for 3D hero -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <style>
    :root{
      --bg1:#071f1b; --bg2:#0b3b36; --mint:#34d399; --ink:#052e2b;
      --glass:rgba(255,255,255,.06); --border:rgba(255,255,255,.12);
    }
    body{background: radial-gradient(1200px 600px at 50% -10%, var(--bg2) 0%, var(--bg1) 60%);
         color:#e9faf4; font-family:'Tajawal',system-ui,Segoe UI,Arial}
    .glassy{background:var(--glass); backdrop-filter: blur(10px); border-bottom:1px solid var(--border)}
    .btn-mint{background:var(--mint); color:var(--ink); font-weight:800}
    .btn-mint:hover{opacity:.92;color:var(--ink)}
    a{color:#b7ffea} a:hover{color:#7ff6d9}
    .section{padding:48px 0}
    /* Router visibility */
    section[hidden]{display:none !important}
    /* Hero 3D */
    .hero{min-height:70vh; display:grid; place-items:center; position:relative; overflow:hidden}
    .hero canvas{position:absolute; inset:0}
    .hero .overlay{position:absolute; inset:0; background: radial-gradient(600px 300px at 50% 0%, rgba(0,0,0,.25), transparent 70%)}
    .card.glass{background:var(--glass);border:1px solid var(--border);box-shadow:0 24px 60px rgba(0,0,0,.35)}
    /* Auth glass */
    .auth-hero{position:relative;min-height:100vh;display:grid;place-items:center;overflow:hidden}
    .auth-bg{position:absolute;inset:0;background:
      radial-gradient(1200px 500px at 50% -10%, #0b3b36 0%, #071f1b 60%),
      repeating-linear-gradient(-12deg,#053b35 0px,#053b35 14px,#0b5c50 14px,#0b5c50 28px);
      opacity:.5}
    .auth-card{padding:22px;border-radius:18px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.06);backdrop-filter:blur(10px)}
    .glass-inp{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);color:#e9faf4}
    .glass-inp:focus{border-color:var(--mint); box-shadow:none}
    /* Chat */
    .chatbox{min-height:280px;max-height:420px;overflow:auto;padding:8px;background:rgba(0,0,0,.2);border-radius:10px;border:1px solid var(--border)}
    .bubble{max-width:72%;margin:6px 0;padding:10px 12px;border-radius:12px}
    .bubble.me{margin-left:auto;background:#34d399;color:#052e2b}
    .bubble.bot{background:rgba(255,255,255,.08);border:1px solid var(--border)}
    footer{color:#a0bdb6}
    /* Simple toast */
    #toast{position:fixed; bottom:16px; right:16px; background:#062a26; color:#c7fff0; border:1px solid #0a4c44; padding:10px 14px; border-radius:10px; display:none; z-index:9999}
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark glassy sticky-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#/home">Ø§Ù„Ù…Ø²Ø§Ø±Ø¹</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" data-link href="#/home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
          <li class="nav-item"><a class="nav-link" data-link href="#/features">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a></li>
          <li class="nav-item"><a class="nav-link" data-link href="#/calendar">Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</a></li>
          <li class="nav-item"><a class="nav-link" data-link href="#/chat">Ù…Ø­Ø§Ø¯Ø«Ø©</a></li>
          <li class="nav-item"><a class="nav-link" data-link href="#/about">ØªØ¹Ø±ÙŠÙ</a></li>
        </ul>
        <ul class="navbar-nav">
          <li class="nav-item" id="nav-login"><a class="nav-link" data-link href="#/login">Ø¯Ø®ÙˆÙ„</a></li>
          <li class="nav-item" id="nav-register"><a class="nav-link" data-link href="#/register">ØªØ³Ø¬ÙŠÙ„</a></li>
          <li class="nav-item d-none" id="nav-logout"><a class="nav-link" href="#" onclick="logout();return false;">Ø®Ø±ÙˆØ¬</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- HOME (3D) -->
  <section id="home" class="hero" hidden>
    <canvas id="farm3d"></canvas>
    <div class="overlay"></div>
    <div class="container position-relative">
      <div class="row justify-content-center">
        <div class="col-lg-8 text-center">
          <h1 class="display-5 fw-bold mb-3">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø°ÙƒÙŠ</h1>
          <p class="lead text-secondary">ØªØ´Ø®ÙŠØµ Ù…Ø¨Ø¯Ø¦ÙŠ Ù„Ù„Ø£Ø¹Ø±Ø§Ø¶ØŒ Ø·Ù‚Ø³ Ù…Ø­Ù„ÙŠØŒ ØªÙ‚ÙˆÙŠÙ… Ø²Ø±Ø§Ø¹ÙŠØŒ ØªÙ‚Ø¯ÙŠØ± Ø¥Ù†ØªØ§Ø¬ÙŠØ©ØŒ ÙˆÙ…Ø­Ø§Ø¯Ø«Ø© Ù…Ø³Ø§Ø¹Ø¯Ø©.</p>
          <div class="d-flex gap-2 justify-content-center mt-3">
            <a class="btn btn-mint px-4" href="#/login">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</a>
            <a class="btn btn-outline-light px-4" href="#/features">ØªØ¹Ø±Ù‘Ù Ø£ÙƒØ«Ø±</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FEATURES (No 3D, image-friendly) -->
  <section id="features" class="section" hidden>
    <div class="container">
      <div class="text-center mb-4">
        <h2 class="fw-bold">Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù†ØµÙ‘Ø©</h2>
        <p class="text-secondary">ÙˆØ§Ø¬Ù‡Ø© Ù†Ø¸ÙŠÙØ© ÙˆØ®Ù„ÙÙŠØ© Ø¨Ø·Ø§Ø¨Ø¹ Ø²Ø±Ø§Ø¹ÙŠØŒ Ø¨Ø¯ÙˆÙ† 3D.</p>
      </div>
      <div class="row g-4">
        <div class="col-lg-6">
          <div class="card glass p-4">
            <h5 class="mb-2">Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø²Ø§Ø±Ø¹</h5>
            <p class="text-secondary">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚ÙˆÙ„ØŒ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø±ÙŠÙ‘ØŒ Ø§Ù„Ù…Ù‡Ø§Ù…ØŒ ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª.</p>
            <ul class="text-secondary small mb-0">
              <li>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø·Ù‚Ø³ ÙˆØ­Ø±Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨Ø©.</li>
              <li>ØªØ°ÙƒÙŠØ± Ø¨Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø²Ø±Ø§Ø¹Ø© ÙˆØ§Ù„Ø±Ø´Ù‘ ÙˆØ§Ù„Ø­ØµØ§Ø¯.</li>
            </ul>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="card glass p-4">
            <h5 class="mb-2">ØªØ´Ø®ÙŠØµ Ù…Ø¨Ø¯Ø¦ÙŠ + ØªÙˆØµÙŠØ§Øª</h5>
            <p class="text-secondary">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª ÙˆÙ…Ù…Ø§Ø±Ø³Ø§Øª ØªØ­Ø³ÙŠÙ†ÙŠØ© Ø¹Ø§Ù…Ø©.</p>
            <ul class="text-secondary small mb-0">
              <li>Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙˆØ³Ù‘Ø¹ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¨Ù†Ù…Ø§Ø°Ø¬ ML.</li>
              <li>Ù†ØµÙˆØµ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø·ÙˆØ§Ø±Ø¦ ÙˆØ£Ù…Ø§Ù† Ø§Ù„Ù…Ø²Ø§Ø±Ø¹.</li>
            </ul>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="card glass p-4">
            <h5 class="mb-2">Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ù…Ø­Ù„ÙŠ</h5>
            <p class="text-secondary">Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø©ØŒ Ø§Ù„Ø±Ø·ÙˆØ¨Ø©ØŒ Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­ ÙˆÙ‡Ø·ÙˆÙ„ Ø§Ù„Ø£Ù…Ø·Ø§Ø±.</p>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="card glass p-4">
            <h5 class="mb-2">ØªÙ‚Ø¯ÙŠØ± Ø¥Ù†ØªØ§Ø¬ÙŠØ©</h5>
            <p class="text-secondary">Ø­Ø³Ø§Ø¨Ø§Øª ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø­Ø© ÙˆØ§Ù„Ù…Ø­ØµÙˆÙ„ ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø²Ø±Ø§Ø¹Ø©.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CALENDAR -->
  <section id="calendar" class="section" hidden>
    <div class="container">
      <div class="d-flex flex-wrap gap-2 align-items-center mb-3">
        <h2 class="m-0">Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ ÙÙŠ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</h2>
        <span class="text-secondary small">Ù†Ø³Ø®Ø© Ø§Ø³ØªØ±Ø´Ø§Ø¯ÙŠØ© â€” ØªØ®ØµÙŠØµÙ‡Ø§ Ø³Ù‡Ù„.</span>
        <div class="ms-auto d-flex gap-2">
          <select id="season" class="form-select form-select-sm glassy text-light border-0" style="width:160px;background:var(--glass)">
            <option value="all">ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ø³Ù…</option>
            <option value="Ø®Ø±ÙŠÙ">Ø§Ù„Ø®Ø±ÙŠÙ</option>
            <option value="Ø´ØªØ§Ø¡">Ø§Ù„Ø´ØªØ§Ø¡</option>
            <option value="ØµÙŠÙ">Ø§Ù„ØµÙŠÙ (Ø¯Ø§Ø± ÙˆØ­Ø§Ù)</option>
          </select>
          <select id="region" class="form-select form-select-sm glassy text-light border-0" style="width:160px;background:var(--glass)">
            <option>ÙƒÙ„ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</option>
            <option>Ø§Ù„Ø¬Ø²ÙŠØ±Ø©</option>
            <option>Ø§Ù„Ù†ÙŠÙ„ Ø§Ù„Ø£Ø¨ÙŠØ¶</option>
            <option>ÙƒØ±Ø¯ÙØ§Ù†</option>
          </select>
        </div>
      </div>
      <div id="months" class="row g-3"></div>
      <div class="text-secondary small mt-3">* Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ø³ØªØ±Ø´Ø§Ø¯ÙŠ ÙˆÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø¨Ø±Ø© ÙˆØ§Ù„Ø·Ù‚Ø³.</div>
    </div>
  </section>

  <!-- CHAT -->
  <section id="chat" class="section" hidden>
    <div class="container">
      <h2 class="mb-3">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ</h2>
      <div class="card glass p-3">
        <div id="chatbox" class="chatbox"></div>
        <form id="chatForm" class="d-flex gap-2 mt-2" onsubmit="return false;">
          <input id="msg" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ..." autocomplete="off">
          <button class="btn btn-mint">Ø¥Ø±Ø³Ø§Ù„</button>
          <button id="clear" class="btn btn-outline-light" type="button">Ù…Ø³Ø­</button>
        </form>
        <div class="small text-secondary mt-2">* Ù†Ø³Ø®Ø© ÙˆØ§Ø¬Ù‡Ø© ÙÙ‚Ø·. Ù„Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø¨Ø§Ùƒ-Ø¥Ù†Ø¯ Ø§Ø³ØªØ®Ø¯Ù… /api/chat.</div>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="section" hidden>
    <div class="container">
      <h2 class="mb-3">Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h2>
      <p class="text-secondary">Ù…Ù†ØµÙ‘Ø© ÙˆÙŠØ¨ Ù„Ù„Ù…Ø²Ø§Ø±Ø¹ÙŠÙ† ÙÙŠ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†: ØªØ´Ø®ÙŠØµ Ù…Ø¨Ø¯Ø¦ÙŠØŒ Ø·Ù‚Ø³ Ù…Ø­Ù„ÙŠØŒ ØªÙ‚ÙˆÙŠÙ…ØŒ ØªÙ‚Ø¯ÙŠØ± Ø¥Ù†ØªØ§Ø¬ÙŠØ©ØŒ ÙˆÙ…Ø­Ø§Ø¯Ø«Ø© Ù…Ø³Ø§Ø¹Ø¯Ø©.</p>
      <div class="card glass p-3">
        <ul class="list-unstyled m-0">
          <li><strong>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</strong> Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§</li>
          <li><strong>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©:</strong> Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</li>
          <li><strong>ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„:</strong> 09xxxxxxxx</li>
          <li><strong>ÙˆØµÙ Ù‚ØµÙŠØ±:</strong> Ù…Ø´Ø±ÙˆØ¹ ØªØ®Ø±Ø¬ Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© ÙÙŠ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†.</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- LOGIN -->
  <section id="login" class="auth-hero" hidden>
    <div class="auth-bg"></div>
    <div class="container position-relative" style="z-index:2">
      <div class="row justify-content-center">
        <div class="col-md-7 col-lg-5">
          <form id="loginForm" class="auth-card">
            <h3 class="mb-2 fw-bold text-center">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
            <p class="text-secondary text-center mb-3">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ! Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.</p>
            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
            <input id="loginUser" name="username" class="form-control glass-inp" required placeholder="farmer123">
            <label class="form-label mt-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input id="loginPass" name="password" type="password" class="form-control glass-inp" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            <div class="d-flex justify-content-between align-items-center mt-2 small">
              <label class="d-flex align-items-center gap-2">
                <input id="remember" type="checkbox" name="remember" class="form-check-input" style="float:none"> ØªØ°ÙƒÙ‘Ø±Ù†ÙŠ
              </label>
              <a class="link-light" href="#">Ù†Ø³ÙŠØªØŸ</a>
            </div>
            <button class="btn btn-mint w-100 mt-3">Ø¯Ø®ÙˆÙ„</button>
            <div class="text-center small mt-2">Ù…Ø§ Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#/register">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a></div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <!-- REGISTER -->
  <section id="register" class="auth-hero" hidden>
    <div class="auth-bg"></div>
    <div class="container position-relative" style="z-index:2">
      <div class="row justify-content-center">
        <div class="col-md-10 col-lg-8">
          <form id="registerForm" class="auth-card">
            <h3 class="mb-2 fw-bold text-center">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                <input id="regUser" name="username" class="form-control glass-inp" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                <input id="regName" name="name" class="form-control glass-inp" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯</label>
                <input id="regEmail" name="email" type="email" class="form-control glass-inp">
              </div>
              <div class="col-md-6">
                <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
                <input id="regDob" name="date_of_birth" type="date" class="form-control glass-inp" required>
                <div class="form-text small">ÙŠØ´ØªØ±Ø· Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø¹Ù…Ø± 10+.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</label>
                <input id="regFarm" name="farm_location" class="form-control glass-inp">
              </div>
              <div class="col-md-6">
                <label class="form-label">ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„</label>
                <input id="regContact" name="contact_details" class="form-control glass-inp">
              </div>
              <div class="col-md-6">
                <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input id="regPass" name="password" type="password" class="form-control glass-inp" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input id="regConf" name="confirm" type="password" class="form-control glass-inp" required>
              </div>
            </div>
            <button class="btn btn-mint w-100 mt-3">ØªØ³Ø¬ÙŠÙ„</button>
            <div class="text-center small mt-2">Ø¹Ù†Ø¯ÙŠ Ø­Ø³Ø§Ø¨ØŸ <a href="#/login">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</a></div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <footer class="text-center py-4 small">
    Â© 2025 Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ â€“ Ù…Ø´Ø±ÙˆØ¹ ØªØ®Ø±Ø¬
  </footer>

  <div id="toast"></div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ===== Tiny SPA Router (hash-based) =====
    const routes = ['home','features','calendar','chat','about','login','register'];
    function show(route){
      routes.forEach(id => {
        const el = document.getElementById(id);
        if(!el) return;
        el.hidden = (id !== route);
      });
      // navbar auth items
      const loggedIn = !!localStorage.getItem('loggedInUser');
      document.getElementById('nav-login').classList.toggle('d-none', loggedIn);
      document.getElementById('nav-register').classList.toggle('d-none', loggedIn);
      document.getElementById('nav-logout').classList.toggle('d-none', !loggedIn);
      // init 3D when entering home
      if(route==='home'){ start3D(); }
    }
    function router(){
      const h = location.hash.replace('#/','') || 'home';
      if(!routes.includes(h)) return show('home');
      show(h);
    }
    window.addEventListener('hashchange', router);
    window.addEventListener('load', router);

    // ===== Toast helper =====
    function toast(msg){
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.style.display='block';
      clearTimeout(t.__hide);
      t.__hide = setTimeout(()=> t.style.display='none', 2500);
    }

    // ===== Auth (Front-end demo only) =====
    function logout(){
      localStorage.removeItem('loggedInUser');
      toast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬.');
      location.hash = '#/login';
      router();
    }
    document.getElementById('loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const u = document.getElementById('loginUser').value.trim();
      const p = document.getElementById('loginPass').value.trim();
      if(!u || !p) return toast('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
      localStorage.setItem('loggedInUser', u);
      toast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.');
      location.hash = '#/home';
      router();
    });
    // Register validation (age >= 10)
    (function(){
      const dob = document.getElementById('regDob');
      if(!dob) return;
      const now = new Date(); now.setFullYear(now.getFullYear()-10);
      dob.max = now.toISOString().slice(0,10);
    })();
    document.getElementById('registerForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const pass = document.getElementById('regPass').value;
      const conf = document.getElementById('regConf').value;
      const dob  = document.getElementById('regDob').value;
      if(pass !== conf) return toast('ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚');
      if(!dob) return toast('Ø£Ø¯Ø®Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯');
      const age = (d => {
        const t=new Date(); const b=new Date(d);
        return t.getFullYear()-b.getFullYear()-((t.getMonth()<b.getMonth()||(t.getMonth()==b.getMonth()&&t.getDate()<b.getDate()))?1:0);
      })(dob);
      if(age < 10) return toast('Ø§Ù„Ø¹Ù…Ø± ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10 Ø³Ù†ÙˆØ§Øª Ø£Ùˆ Ø£ÙƒØ«Ø±');
      toast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ â€” ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†.');
      location.hash = '#/login';
      router();
    });

    // ===== Calendar render =====
    const calData = [
      {m:'ÙŠÙ†Ø§ÙŠØ±', s:'Ø´ØªØ§Ø¡', tips:['ÙØ­Øµ Ø±ÙŠÙ‘ Ø®ÙÙŠÙ + ØªØ³Ù…ÙŠØ¯ Ø¨Ø³ÙŠØ·','ØªØ­Ø¶ÙŠØ± Ù„Ø²Ø±Ø§Ø¹Ø© Ù…Ø¨ÙƒØ±Ø© Ø­ÙŠØ« ÙŠÙ„Ø²Ù…']},
      {m:'ÙØ¨Ø±Ø§ÙŠØ±', s:'Ø´ØªØ§Ø¡', tips:['Ø¹Ø²Ù‚ ÙˆÙ…ÙƒØ§ÙØ­Ø© Ø­Ø´Ø§Ø¦Ø´','Ø¨Ø·Ø§Ø·Ø³/Ø¨Ù‚ÙˆÙ„ÙŠØ§Øª â€“ ØªØ³Ù…ÙŠØ¯ Ù…ØªÙˆØ§Ø²Ù†']},
      {m:'Ù…Ø§Ø±Ø³', s:'Ø§Ù„ØµÙŠÙ (Ø¯Ø§Ø± ÙˆØ­Ø§Ù)', tips:['Ø¨Ø¯Ø§ÙŠØ© Ø³Ø®Ø§Ù†Ø© Ø¸ÙÙ„ Ù„Ù„Ø´ØªÙ„Ø§Øª','ØªØ¬Ù‡ÙŠØ² Ø£Ø±Ø¶ Ø§Ù„ØµÙŠÙ']},
      {m:'Ø£Ø¨Ø±ÙŠÙ„', s:'Ø§Ù„ØµÙŠÙ (Ø¯Ø§Ø± ÙˆØ­Ø§Ù)', tips:['Ù…Ø·Ø§Ø¹Ù…/Ø±Ø§Ù…ÙŠØ© ØµÙŠÙÙŠØ©','Ø°Ø±Ø© Ø±ÙÙŠØ¹Ø© Ù…Ø¨ÙƒØ±Ø©']},
      {m:'Ù…Ø§ÙŠÙˆ', s:'Ø§Ù„ØµÙŠÙ (Ø¯Ø§Ø± ÙˆØ­Ø§Ù)', tips:['Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„Ù„Ø²Ø±ÙØ©Ø› ØµÙŠØ§Ù†Ø© Ù…ØµØ§Ø±Ù','Ø¨Ø°ÙˆØ± Ù…Ø®Ø²Ù†Ø©']},
      {m:'ÙŠÙˆÙ†ÙŠÙˆ', s:'Ø§Ù„ØµÙŠÙ (Ø¯Ø§Ø± ÙˆØ­Ø§Ù)', tips:['Ø§Ù„ØªØ­Ø¶ÙŠØ± Ù‚Ø¨Ù„ Ø§Ù„Ø£Ù…Ø·Ø§Ø±','Ø±Ø´Ù‘ ÙˆÙ‚Ø§Ø¦ÙŠ Ø°Ø±Ø©/Ø³Ù…Ø³Ù…/ÙÙˆÙ„']},
      {m:'ÙŠÙˆÙ„ÙŠÙˆ', s:'Ø§Ù„Ø®Ø±ÙŠÙ', tips:['Ø¨Ø°Ø± Ø§Ù„Ø²Ø±ÙØ©: Ø°Ø±Ø©/Ø³Ù…Ø³Ù…/ÙÙˆÙ„','ÙƒØ´Ù Ù…ØµØ§Ø±Ù']},
      {m:'Ø£ØºØ³Ø·Ø³', s:'Ø§Ù„Ø®Ø±ÙŠÙ', tips:['Ø¨Ø·Ø­Ø› ÙˆÙ‚Øª Ù…Ù†Ø§Ø³Ø¨','ØªØ³Ù…ÙŠØ¯ Ø°Ø±Ø©/Ø³Ù…Ø³Ù…','ÙˆÙ‚Ø§ÙŠØ© ÙØ·Ø±ÙŠØ©']},
      {m:'Ø³Ø¨ØªÙ…Ø¨Ø±', s:'Ø§Ù„Ø®Ø±ÙŠÙ', tips:['Ù†Ø¶Ø¬ Ø¬Ø²Ø¦ÙŠ/Ø¬Ù†ÙŠÙ‘','Ø±ÙŠÙ‘ Ø®ÙÙŠÙ']},
      {m:'Ø£ÙƒØªÙˆØ¨Ø±', s:'Ø§Ù„Ø®Ø±ÙŠÙ/Ø¢Ø®Ø± Ø§Ù„ØµÙŠÙ', tips:['Ù…Ø·Ø§Ø¹Ù…/Ø±Ø§Ù…ÙŠØ©Ø› Ø¨Ø¯Ø§ÙŠØ© Ù…ÙˆØ³Ù…','Ø±Ù‚Ø§Ø¨Ø© Ø­Ø´Ø§Ø¦Ø´ Ù…Ø¨ÙƒØ±Ø©']},
      {m:'Ù†ÙˆÙÙ…Ø¨Ø±', s:'Ø§Ù„Ø´ØªØ§Ø¡', tips:['Ù‚Ù…Ø­/Ø¨Ù‚ÙˆÙ„ÙŠØ§Øª','ÙÙˆÙ„ Ù…ØµØ±ÙŠ/Ø­Ù…Øµ']},
      {m:'Ø¯ÙŠØ³Ù…Ø¨Ø±', s:'Ø§Ù„Ø´ØªØ§Ø¡', tips:['Ø®Ø¶Ø±ÙˆØ§Øª ÙˆØ±Ù‚ÙŠØ© Ø´ØªÙˆÙŠØ©','Ø±ÙŠÙ‘ Ø®ÙÙŠÙ']},
    ];
    function renderCalendar(){
      const sel = document.getElementById('season')?.value || 'all';
      const monthsEl = document.getElementById('months');
      if(!monthsEl) return;
      monthsEl.innerHTML = '';
      calData.filter(x => sel==='all' || x.s===sel).forEach(x => {
        const col = document.createElement('div');
        col.className = 'col-md-4 col-lg-3';
        col.innerHTML = `
          <div class="card glass p-3 h-100">
            <div class="d-flex justify-content-between align-items-center mb-1">
              <span class="badge text-bg-info">${x.s}</span>
              <h5 class="m-0">${x.m}</h5>
            </div>
            <ul class="small text-secondary mb-0">${x.tips.map(t=>`<li>${t}</li>`).join('')}</ul>
          </div>`;
        monthsEl.appendChild(col);
      });
    }
    document.getElementById('season')?.addEventListener('change', renderCalendar);
    // render once when entering calendar
    window.addEventListener('hashchange', ()=> { if(location.hash==='#/calendar') renderCalendar(); });

    // ===== Chat (front-end demo) =====
    (function(){
      const chat = document.getElementById('chatbox');
      const form = document.getElementById('chatForm');
      const input = document.getElementById('msg');
      const clearBtn = document.getElementById('clear');
      if(!chat || !form) return;
      clearBtn.onclick = ()=> chat.innerHTML='';
      form.onsubmit = async () => {
        const text = input.value.trim();
        if(!text) return;
        input.value='';
        add('me', text);
        setTimeout(()=> add('bot', 'Ø³Ø£Ø¬ÙŠØ¨Ùƒ Ø­ÙŠÙ† ÙŠØªÙ… Ø±Ø¨Ø· Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø§Ù„Ø¨Ø§Ùƒ-Ø¥Ù†Ø¯ ğŸŒ± (Ø§Ø³ØªØ¹Ù…Ù„ /api/chat).'), 400);
      };
      function add(who, text){
        const row = document.createElement('div');
        row.className = 'bubble ' + who;
        row.textContent = text;
        chat.appendChild(row);
        chat.scrollTop = chat.scrollHeight;
      }
    })();

    // ===== 3D Hero (Three.js) =====
    let _3dStarted = false;
    function start3D(){
      if(_3dStarted) return; _3dStarted = true;
      const canvas = document.getElementById('farm3d');
      if(!canvas || !window.THREE) return;
      const renderer = new THREE.WebGLRenderer({canvas, antialias:true});
      function resize(){
        renderer.setSize(window.innerWidth, window.innerHeight * 0.7, false);
      }
      resize(); window.addEventListener('resize', resize);

      const scene = new THREE.Scene();
      scene.fog = new THREE.Fog(0x0a2f2b, 8, 40);
      const camera = new THREE.PerspectiveCamera(55, window.innerWidth/window.innerHeight, 0.1, 100);
      camera.position.set(0.6, 3.2, 7.5);
      const hemi = new THREE.HemisphereLight(0xbcd7cc, 0x0a2f2b, 0.8);
      scene.add(hemi);
      const dir = new THREE.DirectionalLight(0xffffff, 0.8); dir.position.set(4,6,3); scene.add(dir);

      const g = new THREE.PlaneGeometry(60, 60, 1, 1);
      const m = new THREE.MeshStandardMaterial({color:0x0b5c50, roughness:0.9, metalness:0.05});
      const ground = new THREE.Mesh(g, m); ground.rotation.x = -Math.PI/2; scene.add(ground);

      const rowMat = new THREE.MeshStandardMaterial({color:0x07443d, roughness:1});
      for(let i=-15;i<=15;i+=1.5){
        const r = new THREE.Mesh(new THREE.BoxGeometry(60, .06, .4), rowMat);
        r.position.set(0, 0.03, i);
        scene.add(r);
      }
      const trunkMat = new THREE.MeshStandardMaterial({color:0x3c2f2f});
      const crownMat = new THREE.MeshStandardMaterial({color:0x2c7a3f, roughness:1});
      function addTree(x, z){
        const t = new THREE.Mesh(new THREE.CylinderGeometry(.07, .07, .6, 8), trunkMat);
        t.position.set(x, .3, z); scene.add(t);
        const c = new THREE.Mesh(new THREE.DodecahedronGeometry(.35, 0), crownMat);
        c.position.set(x, .8, z); scene.add(c);
      }
      for(let i=0;i<18;i++){ addTree(-5 + Math.random()*10, -8 + Math.random()*16); }

      const clock = new THREE.Clock();
      function loop(){
        requestAnimationFrame(loop);
        const t = clock.getElapsedTime();
        camera.position.x = Math.sin(t*0.15)*1.2;
        camera.lookAt(0,0,0);
        renderer.render(scene, camera);
      }
      loop();
    }
  </script>
</body>
</html>
